@startuml Cafe POS System - Complete Class Diagram

!define ABSTRACT abstract
skinparam classAttributeIconSize 0
skinparam packageStyle rectangle
skinparam linetype ortho

title Caf√© POS System - Complete UML Class Diagram

' ============================================
' COMMON LAYER - Value Objects
' ============================================
package "common" #FFEFD5 {
    class Money <<final>> {
        - amount: BigDecimal
        + {static} of(double): Money
        + {static} zero(): Money
        + add(Money): Money
        + subtract(Money): Money
        + multiply(int): Money
        + divide(int): Money
        + compareTo(Money): int
    }
}

' ============================================
' DOMAIN LAYER
' ============================================
package "domain" #E8F5E9 {
    interface OrderRepository {
        + save(Order): void
        + findById(long): Optional<Order>
    }

    interface OrderObserver {
        + updated(Order, String): void
    }

    interface OrderPublisher {
        + register(OrderObserver): void
        + unregister(OrderObserver): void
        + notifyObservers(Order, String): void
    }

    class Order <<final>> implements OrderPublisher {
        - id: long
        - items: List<LineItem>
        - observers: List<OrderObserver>
        + id(): long
        + items(): List<LineItem>
        + addItem(LineItem): void
        + subtotal(): Money
        + taxAtPercent(int): Money
        + totalWithTax(int): Money
        + pay(PaymentStrategy): void
        + markReady(): void
        + removeLastItem(): void
    }

    class LineItem <<final>> {
        - product: Product
        - quantity: int
        + product(): Product
        + quantity(): int
        + lineTotal(): Money
    }

    class OrderIds <<final>> {
        - {static} counter: long
        + {static} next(): long
    }
}

' ============================================
' CATALOG LAYER
' ============================================
package "catalog" #E3F2FD {
    interface Product {
        + id(): String
        + name(): String
        + basePrice(): Money
    }

    class SimpleProduct <<final>> implements Product {
        - id: String
        - name: String
        - basePrice: Money
        + id(): String
        + name(): String
        + basePrice(): Money
        + price(): Money
    }

    interface Catalog {
        + add(Product): void
        + findById(String): Optional<Product>
    }

    class InMemoryCatalog <<final>> implements Catalog {
        - byId: Map<String, Product>
        + add(Product): void
        + findById(String): Optional<Product>
    }
}

' ============================================
' DECORATOR PATTERN
' ============================================
package "decorator" #FFF3E0 {
    interface Priced {
        + price(): Money
    }

    abstract class ProductDecorator implements Product, Priced {
        # base: Product
        # ProductDecorator(Product)
        + id(): String
        + basePrice(): Money
    }

    class ExtraShot <<final>> extends ProductDecorator {
        - {static} SURCHARGE: Money = 0.80
        + name(): String
        + price(): Money
    }

    class OatMilk <<final>> extends ProductDecorator {
        - {static} SURCHARGE: Money = 0.50
        + name(): String
        + price(): Money
    }

    class Syrup <<final>> extends ProductDecorator {
        - {static} SURCHARGE: Money = 0.40
        + name(): String
        + price(): Money
    }

    class SizeLarge <<final>> extends ProductDecorator {
        - {static} SURCHARGE: Money = 0.70
        + name(): String
        + price(): Money
    }
}

' ============================================
' FACTORY PATTERN
' ============================================
package "factory" #FCE4EC {
    class ProductFactory <<final>> {
        + create(String): Product
    }
}

' ============================================
' PAYMENT STRATEGY PATTERN
' ============================================
package "payment" #F3E5F5 {
    interface PaymentStrategy {
        + pay(Order): void
    }

    class CashPayment <<final>> implements PaymentStrategy {
        + pay(Order): void
    }

    class CardPayment <<final>> implements PaymentStrategy {
        - cardNumber: String
        + CardPayment(String)
        + pay(Order): void
    }

    class WalletPayment <<final>> implements PaymentStrategy {
        - walletId: String
        + WalletPayment(String)
        + pay(Order): void
    }
}

' ============================================
' OBSERVER PATTERN
' ============================================
package "observer" #E8EAF6 {
    class KitchenDisplay <<final>> implements domain.OrderObserver {
        + updated(Order, String): void
    }

    class DeliveryDesk <<final>> implements domain.OrderObserver {
        + updated(Order, String): void
    }

    class CustomerNotifier <<final>> implements domain.OrderObserver {
        + updated(Order, String): void
    }
}

' ============================================
' COMMAND PATTERN
' ============================================
package "command" #EFEBE9 {
    interface Command {
        + execute(): void
        + undo(): void
    }

    class AddItemCommand <<final>> implements Command {
        - service: OrderService
        - recipe: String
        - qty: int
        + execute(): void
        + undo(): void
    }

    class PayOrderCommand <<final>> implements Command {
        - service: OrderService
        - strategy: PaymentStrategy
        - taxPercent: int
        + execute(): void
    }

    class MacroCommand <<final>> implements Command {
        - steps: Command[]
        + MacroCommand(Command...)
        + execute(): void
        + undo(): void
    }

    class PosRemote <<final>> {
        - slots: Command[]
        - history: Deque<Command>
        + PosRemote(int)
        + setSlot(int, Command): void
        + press(int): void
        + undo(): void
    }

    class OrderService <<final>> {
        - factory: ProductFactory
        - order: Order
        + OrderService(Order)
        + addItem(String, int): void
        + removeLastItem(): void
        + totalWithTax(int): Money
        + pay(PaymentStrategy, int): void
        + order(): Order
    }
}

' ============================================
' STATE PATTERN
' ============================================
package "state" #E0F7FA {
    interface State {
        + name(): String
        + pay(OrderFSM): void
        + prepare(OrderFSM): void
        + markReady(OrderFSM): void
        + deliver(OrderFSM): void
        + cancel(OrderFSM): void
    }

    class OrderFSM {
        - state: State
        ~ setState(State): void
        + status(): String
        + pay(): void
        + prepare(): void
        + markReady(): void
        + deliver(): void
        + cancel(): void
    }

    class NewState implements State {
        + name(): String
        + pay(OrderFSM): void
        + cancel(OrderFSM): void
    }

    class PreparingState implements State {
        + name(): String
        + prepare(OrderFSM): void
        + markReady(OrderFSM): void
        + cancel(OrderFSM): void
    }

    class ReadyState implements State {
        + name(): String
        + deliver(OrderFSM): void
    }

    class DeliveredState implements State {
        + name(): String
    }

    class CancelledState implements State {
        + name(): String
    }
}

' ============================================
' MENU - COMPOSITE PATTERN
' ============================================
package "menu" #F1F8E9 {
    abstract class MenuComponent <<Iterable>> {
        + add(MenuComponent): void
        + remove(MenuComponent): void
        + getChild(int): MenuComponent
        + childrenIterator(): Iterator
        + name(): String
        + price(): BigDecimal
        + isVegetarian(): boolean
        + print(): void
        + iterator(): Iterator<MenuComponent>
        + allItems(): Stream<MenuItem>
        + vegetarianItems(): Stream<MenuItem>
    }

    class Menu extends MenuComponent {
        - name: String
        - children: List<MenuComponent>
        + Menu(String)
        + add(MenuComponent): void
        + remove(MenuComponent): void
        + getChild(int): MenuComponent
        + iterator(): Iterator<MenuComponent>
        + print(): void
    }

    class MenuItem extends MenuComponent {
        - name: String
        - price: BigDecimal
        - vegetarian: boolean
        + MenuItem(String, BigDecimal, boolean)
        + name(): String
        + price(): BigDecimal
        + isVegetarian(): boolean
        + print(): void
    }

    class CompositeIterator <<Iterator>> {
        - root: MenuComponent
        - emittedRoot: boolean
        - stack: Deque<Iterator>
        + hasNext(): boolean
        + next(): MenuComponent
    }
}

' ============================================
' PRINTING - ADAPTER PATTERN
' ============================================
package "printing" #FBE9E7 {
    interface Printer {
        + print(String): void
    }

    class LegacyPrinterAdapter <<final>> implements Printer {
        - adaptee: LegacyThermalPrinter
        + LegacyPrinterAdapter(LegacyThermalPrinter)
        + print(String): void
    }
}

package "vendor.legacy" #FFEBEE {
    class LegacyThermalPrinter {
        + legacyPrint(byte[]): void
    }
}

' ============================================
' CHECKOUT / PRICING
' ============================================
package "checkout" #E1F5FE {
    interface DiscountPolicy {
        + discountOf(Money): Money
    }

    class LoyaltyPercentDiscount <<final>> implements DiscountPolicy {
        - percent: int
        + discountOf(Money): Money
    }

    class NoDiscount <<final>> implements DiscountPolicy {
        + discountOf(Money): Money
    }

    class FixedCouponDiscount <<final>> implements DiscountPolicy {
        - amount: Money
        + discountOf(Money): Money
    }

    interface TaxPolicy {
        + taxOn(Money): Money
    }

    class FixedRateTaxPolicy <<final>> implements TaxPolicy {
        - percent: int
        + taxOn(Money): Money
        + percent(): int
    }

    class PricingService <<final>> {
        - discountPolicy: DiscountPolicy
        - taxPolicy: TaxPolicy
        + price(Money): PricingResult
    }

    class PricingResult <<record>> {
        + subtotal: Money
        + discount: Money
        + tax: Money
        + total: Money
    }

    class ReceiptPrinter <<final>> {
        + format(String, int, PricingResult, int): String
    }
}

' ============================================
' APPLICATION LAYER
' ============================================
package "app" #FFFDE7 {
    class CheckoutService <<final>> {
        - orders: OrderRepository
        - pricing: PricingService
        + checkout(long, int): String
    }

    class ReceiptFormatter <<final>> {
        + format(long, List<LineItem>, PricingResult, int): String
    }
}

package "app.events" #FFF9C4 {
    class EventBus <<final>> {
        - handlers: Map<Class, List<Consumer>>
        + on(Class<T>, Consumer<T>): void
        + emit(T): void
    }

    interface OrderEvent <<sealed>> {
    }

    class OrderCreated <<record>> implements OrderEvent {
        + orderId: long
    }

    class OrderPaid <<record>> implements OrderEvent {
        + orderId: long
    }
}

' ============================================
' INFRASTRUCTURE LAYER
' ============================================
package "infra" #ECEFF1 {
    class InMemoryOrderRepository <<final>> implements domain.OrderRepository {
        - store: Map<Long, Order>
        + save(Order): void
        + findById(long): Optional<Order>
    }

    class Wiring <<final>> {
        + {static} createDefault(): Components
    }

    class Components <<record>> {
        + repo: OrderRepository
        + pricing: PricingService
        + checkout: CheckoutService
    }
}

' ============================================
' PRESENTATION / UI LAYER
' ============================================
package "ui" #F5F5F5 {
    class OrderController <<final>> {
        - repo: OrderRepository
        - checkout: CheckoutService
        - factory: ProductFactory
        + createOrder(long): long
        + addItem(long, String, int): void
        + checkout(long, int): String
    }

    class ConsoleView <<final>> {
        + print(String): void
    }
}

' ============================================
' RELATIONSHIPS
' ============================================

' Domain relationships
Order "1" *-- "*" LineItem : contains >
LineItem "1" --> "1" Product : references >
Order ..> PaymentStrategy : uses >
Order "1" --> "*" OrderObserver : notifies >

' Decorator relationships
ProductDecorator "1" --> "1" Product : wraps >
SimpleProduct ..|> Priced

' Factory relationships
ProductFactory ..> Product : creates >
ProductFactory ..> ProductDecorator : creates >

' Command relationships
AddItemCommand --> OrderService : uses >
PayOrderCommand --> OrderService : uses >
PayOrderCommand --> PaymentStrategy : uses >
MacroCommand "1" --> "*" Command : contains >
PosRemote "1" --> "*" Command : invokes >
OrderService --> ProductFactory : uses >
OrderService --> Order : manages >

' State relationships
OrderFSM --> State : delegates to >
NewState ..> PreparingState : transitions to >
NewState ..> CancelledState : transitions to >
PreparingState ..> ReadyState : transitions to >
PreparingState ..> CancelledState : transitions to >
ReadyState ..> DeliveredState : transitions to >

' Composite relationships
Menu "1" *-- "*" MenuComponent : children >
CompositeIterator --> MenuComponent : iterates >

' Adapter relationships
LegacyPrinterAdapter --> LegacyThermalPrinter : adapts >

' Checkout relationships
PricingService --> DiscountPolicy : uses >
PricingService --> TaxPolicy : uses >
PricingService ..> PricingResult : creates >

' Application relationships
CheckoutService --> OrderRepository : uses >
CheckoutService --> PricingService : uses >

' Infrastructure relationships
Wiring ..> Components : creates >
Wiring ..> InMemoryOrderRepository : creates >
Wiring ..> PricingService : creates >
Wiring ..> CheckoutService : creates >

' UI relationships
OrderController --> OrderRepository : uses >
OrderController --> CheckoutService : uses >
OrderController --> ProductFactory : uses >

@enduml
